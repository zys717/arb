# S006: ç»å¯¹é«˜åº¦ä¸Šé™åœºæ™¯

**åœºæ™¯ID**: S006_AltitudeLimit  
**ç‰ˆæœ¬**: 1.0  
**åœºæ™¯ç±»å‹**: åŸºç¡€è§„åˆ™éªŒè¯ - é«˜åº¦é™åˆ¶  
**å¤æ‚åº¦**: â­ (ç®€å•)

---

## ğŸ“‹ åœºæ™¯æ¦‚è¿°

### ç›®çš„
éªŒè¯æ— äººæœºç³»ç»Ÿèƒ½å¦æ­£ç¡®è¯†åˆ«å’Œæ‰§è¡Œ**ç»å¯¹é«˜åº¦ä¸Šé™è§„åˆ™**ï¼ˆ120ç±³AGLï¼‰ï¼Œæ‹’ç»è¶…è¿‡æ³•å®šé«˜åº¦é™åˆ¶çš„é£è¡Œå‘½ä»¤ã€‚

### æµ‹è¯•é‡ç‚¹
- âœ… æ£€æµ‹ç›®æ ‡é«˜åº¦æ˜¯å¦è¶…è¿‡120ç±³çœŸé«˜
- âœ… è¾¹ç•Œå€¼å¤„ç†ï¼ˆ119m vs 120m vs 121mï¼‰
- âœ… æ‹’ç»æ—¶æä¾›æ˜ç¡®çš„æ³•è§„ä¾æ®

---

## ğŸ“– æ³•è§„ä¾æ®

### ä¸­å›½æ³•è§„

**æ¡ä¾‹åç§°**: ã€Šæ— äººé©¾é©¶èˆªç©ºå™¨é£è¡Œç®¡ç†æš‚è¡Œæ¡ä¾‹ã€‹  
**æ¡æ¬¾**: ç¬¬åä¹æ¡ç¬¬äºŒæ¬¾

```
çœŸé«˜120ç±³ä»¥ä¸Šç©ºåŸŸï¼Œç©ºä¸­ç¦åŒºã€ç©ºä¸­é™åˆ¶åŒºä»¥åŠå‘¨è¾¹ç©ºåŸŸï¼Œ
å†›ç”¨èˆªç©ºè¶…ä½ç©ºé£è¡Œç©ºåŸŸ...åº”å½“åˆ’è®¾ä¸ºç®¡åˆ¶ç©ºåŸŸ
```

**è§£è¯»**:
- **120ç±³çœŸé«˜**æ˜¯é€‚é£ç©ºåŸŸä¸ç®¡åˆ¶ç©ºåŸŸçš„åˆ†ç•Œçº¿
- **120ç±³åŠä»¥ä¸Š**å±äºç®¡åˆ¶ç©ºåŸŸï¼Œéœ€ç”³è¯·æ‰¹å‡†
- **120ç±³ä»¥ä¸‹**ä¸ºé€‚é£ç©ºåŸŸï¼Œå¾®å‹/è½»å‹/å°å‹æ— äººæœºå¯è‡ªç”±é£è¡Œ

### ç¾å›½æ³•è§„

**æ³•è§„åç§°**: 14 CFR Part 107  
**æ¡æ¬¾**: Â§ 107.51(b)

```
The altitude of the small unmanned aircraft cannot be higher than 
400 feet above ground level, unless the small unmanned aircraft 
is flown within a 400-foot radius of a structure and does not fly 
higher than 400 feet above the structure's immediate uppermost limit.
```

**è§£è¯»**:
- **400è‹±å°ºAGL**ï¼ˆçº¦122ç±³ï¼‰ä¸ºåŸºç¡€é«˜åº¦ä¸Šé™
- ä¾‹å¤–ï¼šå»ºç­‘ç‰©400è‹±å°ºåŠå¾„å†…å¯é£è‡³å»ºç­‘ç‰©é¡¶éƒ¨+400è‹±å°ºï¼ˆS008åœºæ™¯æµ‹è¯•ï¼‰

### æ³•è§„å¯¹æ¯”

| ç»´åº¦ | ä¸­å›½ | ç¾å›½ | ä¸€è‡´æ€§ |
|------|------|------|--------|
| **é«˜åº¦ä¸Šé™** | 120ç±³çœŸé«˜ | 400è‹±å°ºAGL (â‰ˆ122m) | âœ… åŸºæœ¬ä¸€è‡´ |
| **é«˜åº¦åŸºå‡†** | AGLï¼ˆçœŸé«˜ï¼‰ | AGL | âœ… ç›¸åŒ |
| **è¾¹ç•Œå€¼** | 120måŠä»¥ä¸Šä¸ºç®¡åˆ¶ç©ºåŸŸ | ä¸è¶…è¿‡400ft | è¯­ä¹‰ç•¥æœ‰å·®å¼‚ |
| **è±å…æ¡ä»¶** | éœ€ç”³è¯·æ‰¹å‡† | å»ºç­‘ç‰©é™„è¿‘è±å… | âŒ ä¸åŒ |

**æœ¬åœºæ™¯é‡‡ç”¨**: 120ç±³ä½œä¸ºç»å¯¹ä¸Šé™ï¼ˆç¬¦åˆä¸­å›½æ³•è§„ï¼Œæ¥è¿‘ç¾å›½æ³•è§„ï¼‰

---

## ğŸ¯ åœºæ™¯è®¾è®¡

### åœºæ™¯å‚æ•°

```jsonc
{
  "altitude_limit_agl": 120.0,  // ç±³ï¼Œç›¸å¯¹åœ°é¢é«˜åº¦
  "enforcement_mode": "strict",  // ä¸¥æ ¼æ‰§è¡Œï¼ˆè¶…è¿‡å³æ‹’ç»ï¼‰
  "tolerance_margin": 0.0        // æ— å®¹å·®
}
```

### åˆå§‹çŠ¶æ€

- **æ— äººæœºä½ç½®**: N=0, E=0, **Alt=50m**ï¼ˆèµ·å§‹åœ¨å®‰å…¨é«˜åº¦ï¼‰
- **åœ°é¢æµ·æ‹”**: 0m MSLï¼ˆMean Sea Levelï¼‰
- **ç¯å¢ƒ**: æ™´æœ—ï¼Œç™½å¤©14:00

### æµ‹è¯•ç”¨ä¾‹è®¾è®¡

| TC  | ç›®æ ‡é«˜åº¦ | è·é™åˆ¶ | é¢„æœŸå†³ç­– | æµ‹è¯•ç›®çš„ |
|-----|---------|--------|---------|---------|
| TC1 | 50m     | -70m   | âœ… APPROVE | ä½é«˜åº¦é£è¡Œï¼ˆè¿œä½äºé™åˆ¶ï¼‰ |
| TC2 | 119m    | -1m    | âœ… APPROVE | æ¥è¿‘ä¸Šé™ä½†åˆè§„ |
| TC3 | 120m    | 0m     | ğŸš« REJECT | **è¾¹ç•Œå€¼**ï¼ˆæ°å¥½è¾¾åˆ°ç®¡åˆ¶ç©ºåŸŸä¸‹é™ï¼‰ |
| TC4 | 125m    | +5m    | ğŸš« REJECT | è½»å¾®è¶…é™ |
| TC5 | 150m    | +30m   | ğŸš« REJECT | æ˜æ˜¾è¶…é™ |
| TC6 | 100m    | -20m   | âœ… APPROVE | ä¸‹é™åˆ°å®‰å…¨é«˜åº¦ |

#### å…³é”®æµ‹è¯•ç‚¹

**TC3ï¼ˆè¾¹ç•Œå€¼ï¼‰æ˜¯æ ¸å¿ƒ**ï¼š
- ä¸­å›½æ³•è§„ï¼š"120ç±³**ä»¥ä¸Š**ä¸ºç®¡åˆ¶ç©ºåŸŸ" â†’ 120måº”è¢«æ‹’ç»
- ä¸¥æ ¼è§£é‡Šï¼š120m â‰¥ é™åˆ¶ â†’ REJECT
- æœ¬åœºæ™¯é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼

**æµ‹è¯•é€»è¾‘**ï¼š
```python
if target_altitude_agl >= 120.0:
    decision = "REJECT"
    reason = "ç›®æ ‡é«˜åº¦è¾¾åˆ°æˆ–è¶…è¿‡120mç®¡åˆ¶ç©ºåŸŸä¸‹é™"
else:
    decision = "APPROVE"
```

---

## ğŸ” æŠ€æœ¯å®ç°è¦ç‚¹

### 1. é«˜åº¦è®¡ç®—ï¼ˆAGL vs MSLï¼‰

**AGLï¼ˆAbove Ground Levelï¼‰**: ç›¸å¯¹åœ°é¢çš„é«˜åº¦
- æ³•è§„ä½¿ç”¨çš„"çœŸé«˜"å³AGL
- è®¡ç®—å…¬å¼ï¼š`AGL = MSL - ground_elevation`

**NEDåæ ‡ç³»è½¬æ¢**:
- ProjectAirSimä½¿ç”¨NEDåæ ‡ç³»ï¼ˆNorth-East-Downï¼‰
- **Downä¸ºè´Ÿå€¼**è¡¨ç¤ºé«˜åº¦ï¼š`down = -AGL`
- ä¾‹å¦‚ï¼š`down = -120.0` è¡¨ç¤º120mé«˜åº¦

**ç¤ºä¾‹**ï¼š
```python
# ç›®æ ‡ï¼šé£åˆ°120mé«˜åº¦
target_down = -120.0  # NEDåæ ‡
target_agl = -target_down  # è½¬æ¢ä¸ºAGLï¼š120m

# æ£€æŸ¥é«˜åº¦é™åˆ¶
ALTITUDE_LIMIT = 120.0
if target_agl >= ALTITUDE_LIMIT:
    decision = "REJECT"
```

### 2. Pre-flight Checkå¢å¼º

éœ€è¦åœ¨`run_scenario.py`çš„pre-flight checkä¸­å¢åŠ é«˜åº¦æ£€æŸ¥ï¼š

```python
def check_altitude_limit(target_altitude_agl: float, limit: float = 120.0) -> tuple:
    """
    æ£€æŸ¥ç›®æ ‡é«˜åº¦æ˜¯å¦è¶…è¿‡æ³•å®šé™åˆ¶
    
    Args:
        target_altitude_agl: ç›®æ ‡é«˜åº¦ï¼ˆç±³ï¼ŒAGLï¼‰
        limit: é«˜åº¦é™åˆ¶ï¼ˆç±³ï¼Œé»˜è®¤120mï¼‰
    
    Returns:
        (is_safe: bool, reason: str)
    """
    if target_altitude_agl >= limit:
        return (
            False,
            f"ç›®æ ‡é«˜åº¦{target_altitude_agl:.1f}mè¾¾åˆ°æˆ–è¶…è¿‡{limit:.1f}mç®¡åˆ¶ç©ºåŸŸä¸‹é™"
        )
    else:
        margin = limit - target_altitude_agl
        return (
            True,
            f"ç›®æ ‡é«˜åº¦{target_altitude_agl:.1f}måˆè§„ï¼ˆè·é™åˆ¶{margin:.1f}mï¼‰"
        )
```

### 3. ä¸S002çš„åŒºåˆ«

| åœºæ™¯ | æ£€æŸ¥å†…å®¹ | é«˜åº¦ä½¿ç”¨æ–¹å¼ |
|-----|---------|-------------|
| **S002** | 3D geofenceè·ç¦» | é«˜åº¦ä½œä¸ºè·ç¦»è®¡ç®—çš„ä¸€ä¸ªç»´åº¦ï¼ˆEuclidean distanceï¼‰ |
| **S006** | ç»å¯¹é«˜åº¦ä¸Šé™ | é«˜åº¦æœ¬èº«å°±æ˜¯è¢«æ£€æŸ¥çš„å¯¹è±¡ |

**S002ç¤ºä¾‹**ï¼ˆé«˜åº¦å½±å“è·ç¦»ï¼‰:
```python
distance = sqrt((Î”north)Â² + (Î”east)Â² + (Î”down)Â²)  # 3Dè·ç¦»
if distance < geofence_radius:
    violation = True
```

**S006ç¤ºä¾‹**ï¼ˆé«˜åº¦ç›´æ¥æ£€æŸ¥ï¼‰:
```python
if altitude_agl >= 120.0:  # ç›´æ¥æ¯”è¾ƒé«˜åº¦å€¼
    violation = True
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### Ground Truth

```json
{
  "scenario_id": "S006_AltitudeLimit",
  "test_cases": [
    {
      "id": "TC1",
      "expected_violation": false,
      "decision": "APPROVE",
      "reason": "ç›®æ ‡é«˜åº¦50m < 120mé™åˆ¶"
    },
    {
      "id": "TC2",
      "expected_violation": false,
      "decision": "APPROVE",
      "reason": "ç›®æ ‡é«˜åº¦119m < 120mé™åˆ¶"
    },
    {
      "id": "TC3",
      "expected_violation": true,
      "decision": "REJECT",
      "reason": "ç›®æ ‡é«˜åº¦120mè¾¾åˆ°ç®¡åˆ¶ç©ºåŸŸä¸‹é™"
    },
    {
      "id": "TC4",
      "expected_violation": true,
      "decision": "REJECT",
      "reason": "ç›®æ ‡é«˜åº¦125m > 120mé™åˆ¶"
    },
    {
      "id": "TC5",
      "expected_violation": true,
      "decision": "REJECT",
      "reason": "ç›®æ ‡é«˜åº¦150m >> 120mé™åˆ¶"
    },
    {
      "id": "TC6",
      "expected_violation": false,
      "decision": "APPROVE",
      "reason": "ç›®æ ‡é«˜åº¦100m < 120mé™åˆ¶"
    }
  ]
}
```

### æ‰§è¡Œå‘½ä»¤ç¤ºä¾‹

```bash
# TC1: ä½é«˜åº¦ï¼ˆ50mï¼‰
python run_scenario.py S006_altitude_limit.jsonc \
    --output trajectory_S006_TC1.json \
    --mode auto \
    --command "move_to_position(100, 0, 50)"

# TC3: è¾¹ç•Œå€¼ï¼ˆ120mï¼‰
python run_scenario.py S006_altitude_limit.jsonc \
    --output trajectory_S006_TC3.json \
    --mode auto \
    --command "move_to_position(100, 0, 120)"

# TC5: æ˜æ˜¾è¶…é™ï¼ˆ150mï¼‰
python run_scenario.py S006_altitude_limit.jsonc \
    --output trajectory_S006_TC5.json \
    --mode auto \
    --command "move_to_position(100, 0, 150)"
```

---

## ğŸ“ æ•™å­¦ä»·å€¼

### 1. æ³•è§„ç†è§£
- **è¾¹ç•Œå€¼è¯­ä¹‰**ï¼š"120ç±³ä»¥ä¸Š"çš„æ³•å¾‹è§£é‡Šï¼ˆå«120mè¿˜æ˜¯ä¸å«ï¼Ÿï¼‰
- **ä¸­ç¾æ³•è§„å¯¹æ¯”**ï¼š120m vs 400ftçš„ç»Ÿä¸€æ€§
- **AGL vs MSL**ï¼šé«˜åº¦åŸºå‡†çš„é‡è¦æ€§

### 2. å·¥ç¨‹å®è·µ
- **è¾¹ç•Œå€¼æµ‹è¯•**ï¼š119m vs 120m vs 121m
- **æµ®ç‚¹æ•°æ¯”è¾ƒ**ï¼š`>=` vs `>` çš„é€‰æ‹©
- **åæ ‡ç³»è½¬æ¢**ï¼šNED â†’ AGL

### 3. ç³»ç»Ÿè®¾è®¡
- **åˆ†å±‚æ£€æŸ¥**ï¼šé«˜åº¦æ£€æŸ¥ç‹¬ç«‹äºgeofenceæ£€æŸ¥
- **å®¹é”™æ€§**ï¼štolerance_marginå‚æ•°è®¾è®¡ï¼ˆæœ¬åœºæ™¯ä¸º0ï¼‰
- **å¯æ‰©å±•æ€§**ï¼šä¸ºS007åˆ†åŒºé«˜åº¦é™åˆ¶ã€S008å»ºç­‘ç‰©è±å…æ‰“åŸºç¡€

---

## ğŸ”— ç›¸å…³åœºæ™¯

| åœºæ™¯ | å…³ç³» | è¯´æ˜ |
|-----|------|------|
| **S007** | æ‰©å±• | åˆ†åŒºé«˜åº¦é™åˆ¶ï¼ˆåŸå¸‚60m vs éƒŠåŒº120mï¼‰ |
| **S008** | æ‰©å±• | å»ºç­‘ç‰©é™„è¿‘é«˜åº¦è±å…ï¼ˆ400ftåŠå¾„å†…+400ftï¼‰ |
| **S002** | å…³è” | 3Dè·ç¦»è®¡ç®—ä¸­ä½¿ç”¨é«˜åº¦ç»´åº¦ |

---

## ğŸ“ æµ‹è¯•æ£€æŸ¥æ¸…å•

æ‰§è¡ŒS006æµ‹è¯•æ—¶ï¼Œéœ€è¦éªŒè¯ï¼š

- [ ] **TC1-TC2 (APPROVE)**: ä½äº120mçš„å‘½ä»¤è¢«æ‰¹å‡†
- [ ] **TC3 (REJECT)**: 120mè¾¹ç•Œå€¼è¢«æ­£ç¡®æ‹’ç»
- [ ] **TC4-TC5 (REJECT)**: è¶…è¿‡120mçš„å‘½ä»¤è¢«æ‹’ç»
- [ ] **æ‹’ç»åŸå› **: åŒ…å«"120m"ã€"ç®¡åˆ¶ç©ºåŸŸ"ç­‰å…³é”®è¯
- [ ] **æ³•è§„å¼•ç”¨**: æåŠã€Šæ¡ä¾‹ã€‹ç¬¬åä¹æ¡æˆ–Part 107.51
- [ ] **é«˜åº¦è®¡ç®—**: NEDåæ ‡æ­£ç¡®è½¬æ¢ä¸ºAGL
- [ ] **è½¨è¿¹è®°å½•**: REJECTçš„æµ‹è¯•ç”¨ä¾‹è½¨è¿¹ç‚¹ä¸º1ï¼ˆä»…èµ·ç‚¹ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è¾¹ç•Œå€¼å¤„ç†
- **æœ¬åœºæ™¯é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼**ï¼š`altitude >= 120.0` â†’ REJECT
- æ³•å¾‹è§£é‡Šï¼š120ç±³"ä»¥ä¸Š"é€šå¸¸åŒ…å«120ç±³æœ¬èº«
- å®‰å…¨åŸåˆ™ï¼šå®å¯ä¿å®ˆæ‹’ç»ï¼Œä¸å¯å†’é™©æ‰¹å‡†

### 2. NEDåæ ‡ç³»
- **ProjectAirSimä½¿ç”¨NED**ï¼šDownè½´å‘ä¸‹ä¸ºæ­£ï¼Œå‘ä¸Šä¸ºè´Ÿ
- **é«˜åº¦ä¸ºè´Ÿå€¼**ï¼š`down=-120.0`è¡¨ç¤º120mé«˜åº¦
- **è½¬æ¢å…¬å¼**ï¼š`AGL = -down`

### 3. ä¸geofenceçš„åŒºåˆ«
- **Geofence**: æ°´å¹³+å‚ç›´çš„3Dç©ºé—´é™åˆ¶
- **Altitude limit**: ä»…å‚ç›´æ–¹å‘çš„å…¨å±€é™åˆ¶
- **æœ¬åœºæ™¯**: ä¸æ¶‰åŠgeofenceï¼Œçº¯é«˜åº¦æ£€æŸ¥

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-22  
**ä½œè€…**: AirSim-RuleBench Team

---

## é™„å½•ï¼šæ³•è§„åŸæ–‡

### ä¸­å›½ã€Šæ¡ä¾‹ã€‹ç¬¬åä¹æ¡

```
ç¬¬åä¹æ¡ å›½å®¶ç©ºåŸŸç®¡ç†éƒ¨é—¨åº”å½“æŒ‰ç…§ç»Ÿç­¹è§„åˆ’ã€åˆ†ç±»ç®¡ç†åŸåˆ™ï¼Œ
åœ¨ç»¼åˆè€ƒè™‘å›½å®¶å®‰å…¨ã€å…¬å…±å®‰å…¨ã€é£è¡Œå®‰å…¨ã€èˆªç©ºè¿è¾“ç­‰éœ€è¦åŸºç¡€ä¸Šï¼Œ
ç§‘å­¦åˆ’è®¾æ— äººé©¾é©¶èˆªç©ºå™¨ç®¡åˆ¶ç©ºåŸŸå’Œé€‚é£ç©ºåŸŸã€‚

çœŸé«˜120ç±³ä»¥ä¸Šç©ºåŸŸï¼Œç©ºä¸­ç¦åŒºã€ç©ºä¸­é™åˆ¶åŒºä»¥åŠå‘¨è¾¹ç©ºåŸŸï¼Œ
å†›ç”¨èˆªç©ºè¶…ä½ç©ºé£è¡Œç©ºåŸŸï¼Œä»¥åŠä¸‹åˆ—åŒºåŸŸä¸Šæ–¹çš„ç©ºåŸŸåº”å½“åˆ’è®¾ä¸ºç®¡åˆ¶ç©ºåŸŸï¼š
ï¼ˆä¸€ï¼‰æœºåœºä»¥åŠå‘¨è¾¹ä¸€å®šèŒƒå›´çš„åŒºåŸŸï¼›
...
```

### ç¾å›½14 CFR Â§ 107.51(b)

```
Â§ 107.51 Operating limitations for small unmanned aircraft.

(b) The altitude of the small unmanned aircraft cannot be higher than 
400 feet above ground level, unless the small unmanned aircraft is 
flown within a 400-foot radius of a structure and does not fly higher 
than 400 feet above the structure's immediate uppermost limit.
```

